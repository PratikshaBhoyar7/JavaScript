<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX CRUD</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

<h2>AJAX CRUD Operations</h2>

<!-- Create and Update Form -->
<form id="userForm">
    <input type="hidden" id="userId">
    <label>Full Name:</label>
    <input type="text" id="full_name" required><br><br>
    <label>Email:</label>
    <input type="email" id="email" required><br><br>
    <label>Age:</label>
    <input type="number" id="age" required><br><br>
    <button type="submit">Save</button><br>
</form>

<h3>Users List</h3>
<table border="1" id="usersTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Full Name</th>
            <th>Email</th>
            <th>Age</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Users will be populated here -->
    </tbody>
</table>

<script>
$(document).ready(function () {
    // Fetch and display users
    function fetchUsers() {
        $.ajax({
            url: 'ajax_operations.php',
            type: 'POST',
            data: { operation: 'read' },
            dataType: 'json',
            success: function (users) {
                let tableBody = $('#usersTable tbody');
                tableBody.empty();
                users.forEach(user => {
                    tableBody.append(`<tr>
                        <td>${user.id}</td>
                        <td>${user.full_name}</td>
                        <td>${user.email}</td>
                        <td>${user.age}</td>
                        <td>
                            <button onclick="editUser(${user.id}, '${user.full_name}', '${user.email}', ${user.age})">Edit</button>
                            <button onclick="deleteUser(${user.id})">Delete</button>
                        </td>
                    </tr>`);
                });
            }
        });
    }

    fetchUsers();

    // Create or update user
    $('#userForm').submit(function (e) {
        e.preventDefault();

        let userId = $('#userId').val();
        let operation = userId ? 'update' : 'create';

        $.ajax({
            url: 'ajax_operations.php',
            type: 'POST',
            data: {
                operation: operation,
                id: userId,
                full_name: $('#full_name').val(),
                email: $('#email').val(),
                age: $('#age').val()
            },
            success: function (response) {
                alert(response);
                fetchUsers();
                $('#userForm')[0].reset();
                $('#userId').val('');
            }
        });
    });

    // Edit user
    window.editUser = function (id, fullName, email, age) {
        $('#userId').val(id);
        $('#full_name').val(fullName);
        $('#email').val(email);
        $('#age').val(age);
    };

    // Delete user
    window.deleteUser = function (id) {
        if (confirm("Are you sure you want to delete this user?")) {
            $.ajax({
                url: 'ajax_operations.php',
                type: 'POST',
                data: { operation: 'delete', id: id },
                success: function (response) {
                    alert(response);
                    fetchUsers();
                }
            });
        }
    };
});
</script>

</body>
</html>
